{{import "../blocks/forms/input"}}
{{import "../icons/heroicons/ChevronUpDown"}}

{{block dropdown(id="", label="")}}
<div id="{{id}}" class="dropdown"
     x-data="{
        dropdownOpen: false,
        items: [],
        dataLoaded: false,

        async loadItems() {
            try {
                const response = await fetch('/api/currency.json');
                this.items = await response.json();
                this.dataLoaded = true;
            } catch (error) {
                console.error('Failed to load items:', error);
            }
        },

        toggleDropdown() {
            this.dropdownOpen = !this.dropdownOpen;

            if (this.dropdownOpen && !this.dataLoaded) {
                this.loadItems();
            }
        },

        focusInput() {
            this.$nextTick(() => this.$refs[`{{id}}-search`]?.focus());
        },

        clearInput() {
            if (this.$refs[`{{id}}-search`]) {
                this.$refs[`{{id}}-search`].value = '';
            }
        }
    }" class="relative">

    <button @click="toggleDropdown()" x-show="!dropdownOpen">
        <img src="/static/flags/eur.svg" width="24" height="24" alt="EUR"
             class="h-7 w-7 mr-1.5" loading="lazy" />
        <span class="flex flex-col flex-shrink-0 justify-center h-full translate-y-px text-base">
            {{label}}
        </span>
        {{yield ChevronUpDownHeroIcons(id=(id + "-icon"), class="absolute right-0 w-5 h-5 mr-2")}}
    </button>

    <div class="w-full mx-auto" x-show="dropdownOpen" x-cloak>
        {{yield inputField(id=(id + "-search"), type="search",
                           placeholder="Enter your username", class="w-full",
                           required=true, xRef=true)}}
    </div>

    <div x-show="dropdownOpen"
         @click.away="dropdownOpen = false; clearInput()"
         x-transition:enter="ease-out duration-200"
         x-transition:enter-start="-translate-y-2"
         x-transition:enter-end="translate-y-0"
         class="absolute top-1 z-50 w-full mt-12" x-cloak>

        <div class="list">
            <template x-for="item in items" :key="item.Code">
                <div class="item">
                    <img :src="'/static/flags/' + item.Code.toLowerCase() + '.svg'" 
                         :alt="item.Code" 
                         class="h-6 w-6 mr-1.5" 
                         width="24" height="24" loading="lazy" />
                    <b x-text="item.Code"></b> - <span x-text="item.Name"></span>
                </div>
            </template>
        </div>

    </div>
</div>
{{end}}